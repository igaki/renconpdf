# MS Formsに提出された画像ファイルを指定したフォーマットに一括変換するスクリプト
- 学生が提出するファイルは以下のようになっている．
  - 0FBABF78-CCCB-4958-A17B-61BC43EF27D3_工大 太郎.jpeg
  - 0FBABF78-CCCB-4958-A17B-61BC43EF27D3_工大 太郎 1.jpeg
  - test_工大 花子.png
- これを以下のように学生番号_通し番号.pdfなファイルに変換する
  - X0111_1.pdf
  - X0111_2.pdf
  - X0123_1.pdf


## 準備
- 以下のようなフォーマットのcsvファイルを作成する
- 姓名の間に空白が含まれている必要がある

|sid	|name|
|----|----|
|B17000	|工大　太郎|
|B18999	|工大　花子|

- MS Formsで学生が提出したファイルをOneDriveからダウンロードする
- まとめてダウンロードしたファイルを解凍すると以下のようになっている．
- ファイル名_学生の姓名.拡張子．という形式になっている．学生によっては名姓になっていることもあるので注意（もしかしたら変更できるかもしれない）
- フォームで提出するフォーマットとして画像を指定していれば，jpg,png,pdfなどが存在する．ファイル名部分は学生に依存するので，仮に同名のファイルが提出されていた場合，名前 1.jpegのように通し番号がつくっぽい
  - 0FBABF78-CCCB-4958-A17B-61BC43EF27D3_工大 太郎.jpeg
  - 0FBABF78-CCCB-4958-A17B-61BC43EF27D3_工大 太郎 1.jpeg
  - test_工大 花子.png

- プログラムと同じ箇所にフォルダを作成し，↑で解凍したファイルをすべてコピーする
- csvファイルをプログラムと同じ箇所に配置する

## ファイル名の変更(renfile2sid.py)
- main以下に有るcsvファイル名，dir_path(画像ファイルがあるフォルダ名),output_path(学生番号_通し番号.jpg形式のファイルを保存するフォルダ名)を設定し，`python renfile2sid.py` を実行する
- dir_pathのファイルについて，ファイル名が変更されてoutput_pathに移動される

## PDFファイルへの変更(consid2pdf.py)
- main以下に有る以下の設定を行い，`python consid2pdf.py`を実行する
```python
        dir_path = "./exama/output" # imageがあるディレクトリ
        dir_path_pdf = "./exama/output/pdf" # pdfファイルを保存するディレクトリ
        dir_path_complete = "./exama/output/complete" # pdfファイル作成が完了したimageファイルを置くディレクトリ
```
- outputにある学生番号_通し番号.jpgなどの画像データがcompleteに移動され，同時にpdf化されたファイルがpdfフォルダに作成される
- 変換に失敗した画像データがある場合はoutputに残る．その場合，consid2pdf.pyを再実行すると正しく変換されることが有る．

## イレギュラー対応
- 姓名がひっくり返っていることがある
  - 姓名と名姓の両パターンで検索を実施している
- 同名のファイルを同じ学生がアップロードしている
  - ファイル名末尾に" 1.jpg"みたいに通し番号がつくっぽいのでファイル名から姓名を取り出すときに数字を正規表現を利用して削除
- Value errorなどで変換に失敗した画像はそのまま残る．プログラムを再実行すると変換に成功する場合がある．
